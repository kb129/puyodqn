# 画面・UI仕様書

## 画面構成

### 画面一覧
1. **メイン画面** - ゲーム選択メニュー
2. **プレイヤー選択画面** - 対戦モード用設定
3. **ゲーム画面（シングル）** - 1人プレイ
4. **ゲーム画面（対戦）** - 2人対戦
5. **ポーズ画面** - 一時停止メニュー
6. **ゲームオーバー画面** - 結果表示

### 状態遷移図
```
メイン画面
├── [シングルプレイボタン] → ゲーム画面（シングルプレイ）
├── [対戦モードボタン] → プレイヤー選択画面
└── [設定ボタン] → 設定画面（未実装）

プレイヤー選択画面
├── [ゲーム開始ボタン] → ゲーム画面（対戦モード）
└── [戻るボタン] → メイン画面

ゲーム画面（シングル/対戦）
├── [ポーズボタン/ESC] → ポーズ画面
└── [ゲームオーバー条件] → ゲームオーバー画面

ポーズ画面
├── [ゲームを続ける] → ゲーム画面（復帰）
└── [メインメニューに戻る] → メイン画面

ゲームオーバー画面
├── [リトライ] → ゲーム画面（同モード再開）
└── [メインメニューに戻る] → メイン画面
```

## レイアウト仕様

### シングルプレイ画面
```
┌─────────────────────────────────────────────┐
│               PUYO PUYO                     │
│                                             │
│               SCORE: 123,456                │
├─────────────────────────────────────────────┤
│                                             │
│ ┌─────────────────────┐            NEXT    │
│ │                     │           ┌───┐   │
│ │      ゲーム盤面      │           │ R │   │
│ │     (6列x12行)      │           │ G │   │
│ │                     │           └───┘   │
│ │                     │           NEXT2   │
│ │                     │           ┌───┐   │
│ │                     │           │ B │   │
│ └─────────────────────┘           │ Y │   │
│                                   └───┘   │
│                                            │
│                   [PAUSE]                  │
└─────────────────────────────────────────────┘
```

### 対戦モード画面
```
┌─────────────────────────────────────────────────────────────────┐
│                           PUYO PUYO VS                         │
│                                                                 │
│ 1P: 123,456                                    2P: 789,012     │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│ おじゃま予告: ◆●○○                    おじゃま予告: ○○○       │
│                                                                 │
│ ┌─────────────────┐ NEXT      NEXT    ┌─────────────────┐     │
│ │                 │┌───┐    ┌───┐    │                 │     │
│ │   プレイヤーA     ││ R │    │ R │    │   プレイヤーB     │     │
│ │     盤面        ││ G │    │ G │    │     盤面        │     │
│ │  (6列x12行)     │└───┘    └───┘    │  (6列x12行)     │     │
│ │                 │NEXT2             │                 │     │
│ │                 │┌───┐             │                 │     │
│ │                 ││ B │             │                 │     │
│ │                 ││ Y │             │                 │     │
│ └─────────────────┘└───┘             └─────────────────┘     │
│                                                               │
│                          [PAUSE]                             │
└─────────────────────────────────────────────────────────────────┘
```

### プレイヤー選択画面
```
┌─────────────────────────────────────┐
│             PLAYER SELECT           │
├─────────────────────────────────────┤
│                                     │
│  プレイヤーA: [人間プレイヤー ▼]    │
│                                     │
│           VS                        │
│                                     │
│  プレイヤーB: [無能CPU ▼]          │
│                                     │
│                                     │
│     [ゲーム開始]    [戻る]          │
│                                     │
└─────────────────────────────────────┘
```

## UI要素仕様

### ぷよの表現
- **赤ぷよ**: R（赤色背景）
- **青ぷよ**: B（青色背景）
- **緑ぷよ**: G（緑色背景）
- **黄ぷよ**: Y（黄色背景）
- **おじゃまぷよ**: ×（灰色背景）

### おじゃまぷよ予告
- **小おじゃま**: ○（1個分）
- **大おじゃま**: ●（6個分）
- **岩おじゃま**: ◆（30個分）
- **表示順**: 大→小の左詰め
- **例**: ◆●○○ = 岩1 + 大1 + 小2 = 38個

### ネクスト表示
```
NEXT     NEXT2
┌───┐   ┌───┐
│ R │   │ B │  ← 上のぷよ
│ G │   │ Y │  ← 下のぷよ
└───┘   └───┘
```
- **配置**: 各盤面の右側上辺揃え
- **構成**: NextGroup = NEXT + NEXT2（縦並び）

## アニメーション仕様

### 連鎖エフェクト
1. **消去予告**: 対象ぷよ0.1秒点滅
2. **消去実行**: フェードアウト0.1秒  
3. **落下**: 1マス0.1秒で重力落下
4. **次判定**: 連結チェック→次連鎖

### おじゃまぷよ落下
1. **予告更新**: 予告表示→実体生成
2. **落下**: 上から各列分配落下
3. **着地**: 既存ぷよ上積み上がり

### ゲームオーバー
1. **警告**: ゲームオーバーライン到達時点滅
2. **停止**: 全動作停止
3. **遷移**: 1秒後結果画面

## 操作仕様

### キーボード入力
```typescript
// ゲーム中操作
{
  'ArrowLeft': 'move_left',    // または 'A'
  'ArrowRight': 'move_right',  // または 'D'  
  'ArrowDown': 'soft_drop',    // または 'Space', 'S'
  'L': 'rotate_right',
  'K': 'rotate_left',
  'Escape': 'pause',           // または 'P'
}
```

### 同時入力対応
- **2人プレイ時**: 同じキーボードで同時操作可能
- **独立処理**: 各プレイヤーの入力は独立処理
- **衝突なし**: 盤面が別のため入力衝突処理不要

### マウス操作
- **メニュー**: ボタンクリック・ドロップダウン選択
- **ゲーム中**: キーボードのみ

## 状態管理

### アプリケーション状態
```typescript
enum AppState {
  MAIN_MENU = 'main_menu',
  PLAYER_SELECT = 'player_select', 
  GAME_SINGLE = 'game_single',
  GAME_VERSUS = 'game_versus',
  PAUSED = 'paused',
  GAME_OVER = 'game_over'
}
```

### プレイヤー状態
```typescript
interface PlayerState {
  board: Color[][]; // 6x13配列
  fallingPuyo: PuyoPair | null;
  nextPuyos: PuyoPair[]; // [next, next2]
  score: number;
  isChaining: boolean;
  ojamaPending: number;
}
```

### プレイヤータイプ
```typescript
enum PlayerType {
  HUMAN = 'human',
  CPU_WEAK = 'cpu_weak'
}
```

## 技術実装考慮点

### レンダリング最適化
- **差分更新**: 変更された盤面セルのみ再描画
- **Canvas分離**: ゲーム盤面・UIを別Canvas管理
- **アニメーション**: requestAnimationFrame使用

### 入力処理
- **バッファリング**: アニメーション中の入力蓄積
- **デバウンス**: 高速連続入力の制御
- **状態別制御**: ゲーム状態に応じた入力フィルタリング

### パフォーマンス
- **非同期処理**: 連鎖計算でUIブロック回避
- **メモリ管理**: 使い回し可能オブジェクトのプーリング
- **描画最適化**: 画面外要素の描画スキップ